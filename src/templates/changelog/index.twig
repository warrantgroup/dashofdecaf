{% extends "template.twig" %}
{% set active_page = "changelog" %}
 {% block content %}

     <script type="text/javascript">
         $(document).ready(function () {

             /**
              * Find Changes
              * @param params
              */
             function find(params) {
                 $("#changelog").load("changelog", {
                     "filters": getFilters()
                 });
             }

             /**
              * Get filters
              *
              * @returns object
              */
             function getFilters() {
                 var filters = {};
                 filters.dateRange = '';
                 filters.label = '';
                 filters.search = '';

                 filters.label = $("select[name='label']").val();
                 filters.search = $("input:text[name='search']").val();
                 filters.acceptedDateRange = $("select[name='dateRange']").val();

                 return filters;
             }

             // Show inital stories
             find();

             var delay = (function(){
                 var timer = 0;
                 return function(callback, ms){
                     clearTimeout (timer);
                     timer = setTimeout(callback, ms);
                 };
             })();

             // Filter on label
             $("label").change(function() {
                 find();
             });

             // Filter on search query
             $('input:text[name="search"]').on('input', function() {
                 delay(function(){
                     find();
                 }, 400 );
             });

             // Filter on date range
             $('select[name="dateRange"]').on('change', function() {
                 find();
             });

             $("div .panel-body li").click(function() {
                 $(this).next("ul").toggle();
             });

         });
     </script>

     <div class="container">

         <div class="row" style="margin-bottom: 15px; margin-left: 1px;">
             <div class="input-group">
                 <input type="text" class="form-control" name="search" placeholder="Search term...">
                        <span class="input-group-btn">
                            <button class="btn btn-default" type="button"><span
                                        class="glyphicon glyphicon-search"></span></button>
                        </span>
             </div>
         </div>

         <div class="row">
             <div class="col-md-9" id="changelog">
             </div>

             <div class="col-md-3">
                 {% include 'changelog/filters.twig' %}
             </div>
         </div>
     </div>
 {% endblock %}